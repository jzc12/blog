import{ax as f,b5 as C,bf as x,o,c as r,bg as y,b as a,aK as g,b6 as m,aO as _,aP as M,b7 as l,bh as L,aB as u,bi as k,d as I,aI as T,aJ as D,bj as A,bk as F,aA as v,aD as H,aN as N}from"./index-494402ca.js";const b=["快乐的","可爱的","聪明的","温柔的","活泼的","优雅的","善良的","开朗的","文静的","机智的","幽默的","热情的"],w=["小猫","小狗","小兔","小鸟","小熊","小鹿","小象","小狐狸","小松鼠","小浣熊","小海豚","小企鹅"],B={name:"MessageForm",data(){return{showInputs:!0,message:{username:"",content:"",private_message:!1},dailyLimit:20,todayCount:0,isLoadingCount:!1}},computed:{remainingMessages(){return Math.max(0,this.dailyLimit-this.todayCount)},isLimitReached(){return this.remainingMessages<=0},iconMap(){return C}},methods:{generateRandomName(){const s=b[Math.floor(Math.random()*b.length)],e=w[Math.floor(Math.random()*w.length)];this.message.username=s+e},async fetchTodayCount(){this.isLoadingCount=!0,this.todayCount=await x(),this.isLoadingCount=!1},async submitMessage(){this.isLimitReached||!this.message.content.trim()||(this.$emit("message-submitted",{...this.message}),this.message.content="",this.message.private_message=!1,this.$nextTick(()=>{this.$refs.contentInput.style.height="auto"}),await this.fetchTodayCount())},handleEnter(s){s.shiftKey||this.submitMessage()},adjustTextareaHeight(){const s=this.$refs.contentInput;s.style.height="auto",s.style.height=s.scrollHeight+"px"}},mounted(){this.$refs.contentInput.addEventListener("input",this.adjustTextareaHeight),this.fetchTodayCount()},watch:{showInputs(s){this.$nextTick(()=>{const e=this.$refs.contentInput;s&&e?e.addEventListener("input",this.adjustTextareaHeight):e&&e.removeEventListener("input",this.adjustTextareaHeight)})}}},S={class:"message-form"},j={key:0,class:"limit-warning"},E={class:"form-header"},V={key:2,class:"private-toggle"},R={class:"message-info"},q={key:0,class:"input-group"};function z(s,e,d,c,n,t){return o(),r("div",S,[t.isLimitReached?(o(),r("div",j," 今日留言已达上限（20条），请明天再来留言 ")):(o(),r("form",{key:1,onSubmit:e[6]||(e[6]=y((...i)=>t.submitMessage&&t.submitMessage(...i),["prevent"])),class:"form-container"},[a("div",E,[a("button",{type:"button",class:"toggle-input-btn",onClick:e[0]||(e[0]=i=>n.showInputs=!n.showInputs)},[(o(),g(m(n.showInputs?t.iconMap.squareChevronDown:t.iconMap.squareChevronUp)))]),n.showInputs?_((o(),r("input",{key:0,type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>n.message.username=i),required:"",placeholder:"昵称",class:"name-input"},null,512)),[[M,n.message.username]]):l("",!0),n.showInputs?(o(),r("button",{key:1,type:"button",class:"toggle-input-btn",onClick:e[2]||(e[2]=(...i)=>t.generateRandomName&&t.generateRandomName(...i)),title:"随机昵称"},[(o(),g(m(t.iconMap.shuffle)))])):l("",!0),n.showInputs?(o(),r("label",V,[_(a("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=i=>n.message.private_message=i)},null,512),[[L,n.message.private_message]]),e[7]||(e[7]=a("span",{class:"toggle-label"},"私信",-1))])):l("",!0),a("div",R,u(n.isLoadingCount?"加载中...":`今日剩余留言次数：${t.remainingMessages}`),1)]),n.showInputs?(o(),r("div",q,[_(a("textarea",{"onUpdate:modelValue":e[4]||(e[4]=i=>n.message.content=i),required:"",rows:"1",placeholder:"输入留言内容...",class:"content-input",onKeydown:e[5]||(e[5]=k(y((...i)=>t.handleEnter&&t.handleEnter(...i),["prevent"]),["enter"])),ref:"contentInput"},null,544),[[M,n.message.content]]),e[8]||(e[8]=a("button",{type:"submit",class:"submit-btn",title:"发送"}," 发送 ",-1))])):l("",!0)],32))])}const K=f(B,[["render",z],["__scopeId","data-v-3432e095"]]);const U={name:"MessageList",props:{messages:{type:Array,default:()=>[]}},methods:{formatDate(s){if(!s)return"";const e=new Date(s),d=new Date,c=d-e;return c<24*60*60*1e3&&e.getDate()===d.getDate()?e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):c<7*24*60*60*1e3?["周日","周一","周二","周三","周四","周五","周六"][e.getDay()]+" "+e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},scrollToBottom(){this.$nextTick(()=>{const s=this.$refs.messagesContainer;s&&(s.scrollTop=s.scrollHeight)})}},watch:{messages:{handler(){this.scrollToBottom()},deep:!0}},mounted(){this.scrollToBottom()}},J={class:"message-list"},O={key:0,class:"no-messages"},P={key:1,class:"messages-container",ref:"messagesContainer"},G={class:"message-content"},Q={class:"message-header"},W={class:"user-name"},X={class:"message-date"},Y={class:"message-text"};function Z(s,e,d,c,n,t){return o(),r("div",J,[d.messages.length===0?(o(),r("div",O,e[0]||(e[0]=[a("i",{class:"far fa-comments"},null,-1),I(" 还没有留言，来做第一个留言的人吧！ ")]))):(o(),r("div",P,[(o(!0),r(T,null,D(d.messages,(i,h)=>(o(),r("div",{key:h,class:"message-item"},[a("div",G,[a("div",Q,[a("span",W,u(i.username),1),a("span",X,u(t.formatDate(i.created_at)),1)]),a("div",Y,u(i.content),1)])]))),128))],512))])}const $=f(U,[["render",Z],["__scopeId","data-v-ab55ad81"]]);const ee={name:"Message",components:{MessageForm:K,MessageList:$},data(){return{messages:[],isInputHidden:!1,isLoading:!1,isAscending:!0}},computed:{sortedMessages(){return[...this.messages].sort((s,e)=>{const d=new Date(s.created_at).getTime(),c=new Date(e.created_at).getTime();return this.isAscending?d-c:c-d})},iconMap(){return C}},methods:{toggleSort(){this.isAscending=!this.isAscending},async addMessage(s){try{await A(s)?(await this.loadMessages(),this.$refs.messageForm&&await this.$refs.messageForm.fetchTodayCount()):alert("发送消息失败，请稍后重试")}catch(e){console.error("发送消息失败：",e),alert("发送消息失败，请稍后重试")}},async loadMessages(){if(!this.isLoading){this.isLoading=!0;try{const s=await F();this.messages=s,this.$refs.messageForm&&await this.$refs.messageForm.fetchTodayCount()}catch(s){console.error("加载消息失败：",s),alert("加载消息失败，请稍后重试")}finally{this.isLoading=!1}}},toggleInput(){this.isInputHidden=!this.isInputHidden}},created(){this.loadMessages()}},se={class:"message-page"},te={class:"message-container"},ne={class:"controls"},ae={class:"control-group"},ie=["title"],oe=["disabled"];function re(s,e,d,c,n,t){const i=v("MessageList"),h=v("MessageForm");return o(),r("div",se,[a("div",te,[a("div",ne,[e[2]||(e[2]=a("div",{class:"text"},[a("p",null,"欢迎留言！私信不会显示，但是我会收到")],-1)),a("div",ae,[a("button",{class:"control-btn",onClick:e[0]||(e[0]=(...p)=>t.toggleSort&&t.toggleSort(...p)),title:n.isAscending?"切换为最新消息在前":"切换为最早消息在前"},[(o(),g(m(n.isAscending?t.iconMap.sortDesc:t.iconMap.sortAsc),{class:"icon"}))],8,ie),a("button",{class:"control-btn",onClick:e[1]||(e[1]=(...p)=>t.loadMessages&&t.loadMessages(...p)),disabled:n.isLoading,title:"刷新留言"},[(o(),g(m(n.isLoading?t.iconMap.loading:t.iconMap.refresh),{class:"icon"}))],8,oe)])]),H(i,{messages:t.sortedMessages},null,8,["messages"]),a("div",{class:N(["input-area",{hidden:n.isInputHidden}])},[n.isInputHidden?l("",!0):(o(),g(h,{key:0,ref:"messageForm",onMessageSubmitted:t.addMessage},null,8,["onMessageSubmitted"]))],2)])])}const ce=f(ee,[["render",re],["__scopeId","data-v-9755dd81"]]);export{ce as default};
