import{aw as E,b5 as $,bj as Q,o as _,c as b,bk as R,b as m,aK as L,b6 as A,aO as T,aP as H,b7 as C,bl as W,aB as k,bm as X,bf as Y,av as x,aA as ee,aI as te,aJ as se,bn as ne,bo as ae,az as V,aD as re,aN as oe}from"./index-2fd02547.js";const U=["快乐的","可爱的","聪明的","温柔的","活泼的","优雅的","善良的","开朗的","文静的","机智的","幽默的","热情的"],z=["小猫","小狗","小兔","小鸟","小熊","小鹿","小象","小狐狸","小松鼠","小浣熊","小海豚","小企鹅"],ie={name:"MessageForm",data(){return{showInputs:!0,message:{username:"",content:"",email:"",private_message:!1},dailyLimit:20,todayCount:0,isLoadingCount:!1}},computed:{remainingMessages(){return Math.max(0,this.dailyLimit-this.todayCount)},isLimitReached(){return this.remainingMessages<=0},iconMap(){return $}},methods:{generateRandomName(){const u=U[Math.floor(Math.random()*U.length)],o=z[Math.floor(Math.random()*z.length)];this.message.username=u+o},async fetchTodayCount(){this.isLoadingCount=!0,this.todayCount=await Q(),this.isLoadingCount=!1},async submitMessage(){this.isLimitReached||!this.message.content.trim()||(this.$emit("message-submitted",{...this.message}),this.message.content="",this.message.private_message=!1,this.$nextTick(()=>{this.$refs.contentInput.style.height="auto"}),await this.fetchTodayCount())},handleEnter(u){u.shiftKey||this.submitMessage()},adjustTextareaHeight(){const u=this.$refs.contentInput;u.style.height="auto",u.style.height=u.scrollHeight+"px"}},mounted(){this.$refs.contentInput.addEventListener("input",this.adjustTextareaHeight),this.fetchTodayCount()},watch:{showInputs(u){this.$nextTick(()=>{const o=this.$refs.contentInput;u&&o?o.addEventListener("input",this.adjustTextareaHeight):o&&o.removeEventListener("input",this.adjustTextareaHeight)})}}},ce={class:"message-form"},de={key:0,class:"limit-warning"},ue={class:"form-header"},le={key:2,class:"private-toggle"},ge={class:"message-info"},me={key:0,class:"input-group"};function he(u,o,h,w,l,c){return _(),b("div",ce,[c.isLimitReached?(_(),b("div",de," 今日留言已达上限（20条），请明天再来留言 ")):(_(),b("form",{key:1,onSubmit:o[7]||(o[7]=R((...d)=>c.submitMessage&&c.submitMessage(...d),["prevent"])),class:"form-container"},[m("div",ue,[m("button",{type:"button",class:"toggle-input-btn",onClick:o[0]||(o[0]=d=>l.showInputs=!l.showInputs)},[(_(),L(A(l.showInputs?c.iconMap.squareChevronDown:c.iconMap.squareChevronUp)))]),l.showInputs?T((_(),b("input",{key:0,type:"text","onUpdate:modelValue":o[1]||(o[1]=d=>l.message.username=d),required:"",placeholder:"昵称",class:"name-input"},null,512)),[[H,l.message.username]]):C("",!0),l.showInputs?(_(),b("button",{key:1,type:"button",class:"toggle-input-btn",onClick:o[2]||(o[2]=(...d)=>c.generateRandomName&&c.generateRandomName(...d)),title:"随机昵称"},[(_(),L(A(c.iconMap.shuffle)))])):C("",!0),l.showInputs?(_(),b("label",le,[T(m("input",{type:"checkbox","onUpdate:modelValue":o[3]||(o[3]=d=>l.message.private_message=d)},null,512),[[W,l.message.private_message]]),o[8]||(o[8]=m("span",{class:"toggle-label"},"私信",-1))])):C("",!0),T(m("input",{"onUpdate:modelValue":o[4]||(o[4]=d=>l.message.email=d),placeholder:"邮箱（可选）",type:"email",class:"email-input"},null,512),[[H,l.message.email]]),m("div",ge,k(l.isLoadingCount?"Loading...":`Left:${c.remainingMessages}`),1)]),l.showInputs?(_(),b("div",me,[T(m("textarea",{"onUpdate:modelValue":o[5]||(o[5]=d=>l.message.content=d),required:"",rows:"1",placeholder:"输入留言内容...",class:"content-input",onKeydown:o[6]||(o[6]=X(R((...d)=>c.handleEnter&&c.handleEnter(...d),["prevent"]),["enter"])),ref:"contentInput"},null,544),[[H,l.message.content]]),o[9]||(o[9]=m("button",{type:"submit",class:"submit-btn",title:"发送"}," 发送 ",-1))])):C("",!0)],32))])}const fe=E(ie,[["render",he],["__scopeId","data-v-55267fe4"]]);var G={exports:{}};(function(u){(function(o){function h(e,i){var t=(e&65535)+(i&65535),g=(e>>16)+(i>>16)+(t>>16);return g<<16|t&65535}function w(e,i){return e<<i|e>>>32-i}function l(e,i,t,g,p,M){return h(w(h(h(i,e),h(g,M)),p),t)}function c(e,i,t,g,p,M,y){return l(i&t|~i&g,e,i,p,M,y)}function d(e,i,t,g,p,M,y){return l(i&g|t&~g,e,i,p,M,y)}function v(e,i,t,g,p,M,y){return l(i^t^g,e,i,p,M,y)}function f(e,i,t,g,p,M,y){return l(t^(i|~g),e,i,p,M,y)}function I(e,i){e[i>>5]|=128<<i%32,e[(i+64>>>9<<4)+14]=i;var t,g,p,M,y,s=1732584193,n=-271733879,a=-1732584194,r=271733878;for(t=0;t<e.length;t+=16)g=s,p=n,M=a,y=r,s=c(s,n,a,r,e[t],7,-680876936),r=c(r,s,n,a,e[t+1],12,-389564586),a=c(a,r,s,n,e[t+2],17,606105819),n=c(n,a,r,s,e[t+3],22,-1044525330),s=c(s,n,a,r,e[t+4],7,-176418897),r=c(r,s,n,a,e[t+5],12,1200080426),a=c(a,r,s,n,e[t+6],17,-1473231341),n=c(n,a,r,s,e[t+7],22,-45705983),s=c(s,n,a,r,e[t+8],7,1770035416),r=c(r,s,n,a,e[t+9],12,-1958414417),a=c(a,r,s,n,e[t+10],17,-42063),n=c(n,a,r,s,e[t+11],22,-1990404162),s=c(s,n,a,r,e[t+12],7,1804603682),r=c(r,s,n,a,e[t+13],12,-40341101),a=c(a,r,s,n,e[t+14],17,-1502002290),n=c(n,a,r,s,e[t+15],22,1236535329),s=d(s,n,a,r,e[t+1],5,-165796510),r=d(r,s,n,a,e[t+6],9,-1069501632),a=d(a,r,s,n,e[t+11],14,643717713),n=d(n,a,r,s,e[t],20,-373897302),s=d(s,n,a,r,e[t+5],5,-701558691),r=d(r,s,n,a,e[t+10],9,38016083),a=d(a,r,s,n,e[t+15],14,-660478335),n=d(n,a,r,s,e[t+4],20,-405537848),s=d(s,n,a,r,e[t+9],5,568446438),r=d(r,s,n,a,e[t+14],9,-1019803690),a=d(a,r,s,n,e[t+3],14,-187363961),n=d(n,a,r,s,e[t+8],20,1163531501),s=d(s,n,a,r,e[t+13],5,-1444681467),r=d(r,s,n,a,e[t+2],9,-51403784),a=d(a,r,s,n,e[t+7],14,1735328473),n=d(n,a,r,s,e[t+12],20,-1926607734),s=v(s,n,a,r,e[t+5],4,-378558),r=v(r,s,n,a,e[t+8],11,-2022574463),a=v(a,r,s,n,e[t+11],16,1839030562),n=v(n,a,r,s,e[t+14],23,-35309556),s=v(s,n,a,r,e[t+1],4,-1530992060),r=v(r,s,n,a,e[t+4],11,1272893353),a=v(a,r,s,n,e[t+7],16,-155497632),n=v(n,a,r,s,e[t+10],23,-1094730640),s=v(s,n,a,r,e[t+13],4,681279174),r=v(r,s,n,a,e[t],11,-358537222),a=v(a,r,s,n,e[t+3],16,-722521979),n=v(n,a,r,s,e[t+6],23,76029189),s=v(s,n,a,r,e[t+9],4,-640364487),r=v(r,s,n,a,e[t+12],11,-421815835),a=v(a,r,s,n,e[t+15],16,530742520),n=v(n,a,r,s,e[t+2],23,-995338651),s=f(s,n,a,r,e[t],6,-198630844),r=f(r,s,n,a,e[t+7],10,1126891415),a=f(a,r,s,n,e[t+14],15,-1416354905),n=f(n,a,r,s,e[t+5],21,-57434055),s=f(s,n,a,r,e[t+12],6,1700485571),r=f(r,s,n,a,e[t+3],10,-1894986606),a=f(a,r,s,n,e[t+10],15,-1051523),n=f(n,a,r,s,e[t+1],21,-2054922799),s=f(s,n,a,r,e[t+8],6,1873313359),r=f(r,s,n,a,e[t+15],10,-30611744),a=f(a,r,s,n,e[t+6],15,-1560198380),n=f(n,a,r,s,e[t+13],21,1309151649),s=f(s,n,a,r,e[t+4],6,-145523070),r=f(r,s,n,a,e[t+11],10,-1120210379),a=f(a,r,s,n,e[t+2],15,718787259),n=f(n,a,r,s,e[t+9],21,-343485551),s=h(s,g),n=h(n,p),a=h(a,M),r=h(r,y);return[s,n,a,r]}function F(e){var i,t="",g=e.length*32;for(i=0;i<g;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}function D(e){var i,t=[];for(t[(e.length>>2)-1]=void 0,i=0;i<t.length;i+=1)t[i]=0;var g=e.length*8;for(i=0;i<g;i+=8)t[i>>5]|=(e.charCodeAt(i/8)&255)<<i%32;return t}function J(e){return F(I(D(e),e.length*8))}function O(e,i){var t,g=D(e),p=[],M=[],y;for(p[15]=M[15]=void 0,g.length>16&&(g=I(g,e.length*8)),t=0;t<16;t+=1)p[t]=g[t]^909522486,M[t]=g[t]^1549556828;return y=I(p.concat(D(i)),512+i.length*8),F(I(M.concat(y),512+128))}function N(e){var i="0123456789abcdef",t="",g,p;for(p=0;p<e.length;p+=1)g=e.charCodeAt(p),t+=i.charAt(g>>>4&15)+i.charAt(g&15);return t}function q(e){return unescape(encodeURIComponent(e))}function S(e){return J(q(e))}function P(e){return N(S(e))}function j(e,i){return O(q(e),q(i))}function Z(e,i){return N(j(e,i))}function B(e,i,t){return i?t?j(i,e):Z(i,e):t?S(e):P(e)}u.exports?u.exports=B:o.md5=B})(Y)})(G);var pe=G.exports;const K=x(pe);const ve={name:"MessageList",props:{messages:{type:Array,default:()=>[]}},methods:{formatDate(u){if(!u)return"";const o=new Date(u),h=new Date,w=h-o;return w<24*60*60*1e3&&o.getDate()===h.getDate()?o.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):w<7*24*60*60*1e3?["周日","周一","周二","周三","周四","周五","周六"][o.getDay()]+" "+o.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):o.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},scrollToBottom(){this.$nextTick(()=>{const u=this.$refs.messagesContainer;u&&(u.scrollTop=u.scrollHeight)})},getAvatar(u){if(u&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u)){const o=u.trim().toLowerCase(),h=o.match(/^(\d{5,11})@qq\.com$/);return h?`https://q1.qlogo.cn/g?b=qq&nk=${h[1]}&s=100`:o.match(/^([a-zA-Z0-9_.-]+)@(163|126|yeah)\.com$/)?`https://www.gravatar.com/avatar/${K(o)}?d=identicon`:`https://www.gravatar.com/avatar/${K(o)}?d=identicon`}else return"../assets/avatar.png"},onAvatarError(u){u.target.src=require("../assets/avatar.png")}},watch:{messages:{handler(){this.scrollToBottom()},deep:!0}},mounted(){this.scrollToBottom()}},_e={class:"message-list"},Me={key:0,class:"no-messages"},ye={key:1,class:"messages-container",ref:"messagesContainer"},be={class:"message-content"},we={class:"message-header"},Ce=["src"],Le={class:"user-name"},Ie={class:"message-date"},Te={class:"message-text"};function ke(u,o,h,w,l,c){return _(),b("div",_e,[h.messages.length===0?(_(),b("div",Me,o[1]||(o[1]=[m("i",{class:"far fa-comments"},null,-1),ee(" 还没有留言，来做第一个留言的人吧！ ")]))):(_(),b("div",ye,[(_(!0),b(te,null,se(h.messages,(d,v)=>(_(),b("div",{key:v,class:"message-item"},[m("div",be,[m("div",we,[m("img",{src:c.getAvatar(d.email),class:"avatar",onError:o[0]||(o[0]=f=>c.onAvatarError(f))},null,40,Ce),m("span",Le,k(d.username),1),m("span",Ie,k(c.formatDate(d.created_at)),1)]),m("div",Te,k(d.content),1)])]))),128))],512))])}const Ae=E(ve,[["render",ke],["__scopeId","data-v-50ee6080"]]);const De={name:"Message",components:{MessageForm:fe,MessageList:Ae},data(){return{messages:[],isInputHidden:!1,isLoading:!1,isAscending:!0}},computed:{sortedMessages(){return[...this.messages].sort((u,o)=>{const h=new Date(u.created_at).getTime(),w=new Date(o.created_at).getTime();return this.isAscending?h-w:w-h})},iconMap(){return $}},methods:{toggleSort(){this.isAscending=!this.isAscending},async addMessage(u){try{await ne(u)?(await this.loadMessages(),this.$refs.messageForm&&await this.$refs.messageForm.fetchTodayCount()):alert("发送消息失败，请稍后重试")}catch(o){console.error("发送消息失败：",o),alert("发送消息失败，请稍后重试")}},async loadMessages(){if(!this.isLoading){this.isLoading=!0;try{const u=await ae();this.messages=u,this.$refs.messageForm&&await this.$refs.messageForm.fetchTodayCount()}catch(u){console.error("加载消息失败：",u),alert("加载消息失败，请稍后重试")}finally{this.isLoading=!1}}},toggleInput(){this.isInputHidden=!this.isInputHidden}},created(){this.loadMessages()}},qe={class:"message-page"},He={class:"message-container"},Ee={class:"controls"},Fe={class:"control-group"},Ne=["title"],Se=["disabled"];function je(u,o,h,w,l,c){const d=V("MessageList"),v=V("MessageForm");return _(),b("div",qe,[m("div",He,[m("div",Ee,[o[2]||(o[2]=m("div",{class:"text"},[m("p",null,"欢迎留言！私信不会显示，但是我会收到")],-1)),m("div",Fe,[m("button",{class:"control-btn",onClick:o[0]||(o[0]=(...f)=>c.toggleSort&&c.toggleSort(...f)),title:l.isAscending?"切换为最新消息在前":"切换为最早消息在前"},[(_(),L(A(l.isAscending?c.iconMap.sortDesc:c.iconMap.sortAsc),{class:"icon"}))],8,Ne),m("button",{class:"control-btn",onClick:o[1]||(o[1]=(...f)=>c.loadMessages&&c.loadMessages(...f)),disabled:l.isLoading,title:"刷新留言"},[(_(),L(A(l.isLoading?c.iconMap.loading:c.iconMap.refresh),{class:"icon"}))],8,Se)])]),re(d,{messages:c.sortedMessages},null,8,["messages"]),m("div",{class:oe(["input-area",{hidden:l.isInputHidden}])},[l.isInputHidden?C("",!0):(_(),L(v,{key:0,ref:"messageForm",onMessageSubmitted:c.addMessage},null,8,["onMessageSubmitted"]))],2)])])}const Re=E(De,[["render",je],["__scopeId","data-v-9755dd81"]]);export{Re as default};
