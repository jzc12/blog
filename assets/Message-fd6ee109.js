import{_ as h,o,c as r,i as u,j as _,v as p,b as t,k as v,t as g,F as M,d as b,r as f,g as y,n as L}from"./index-dd199077.js";const w={name:"MessageForm",data(){return{message:{name:"",content:"",date:null},dailyLimit:20}},computed:{todayMessages(){const e=new Date().toLocaleDateString();return JSON.parse(localStorage.getItem("blog-messages")||"[]").filter(d=>new Date(d.date).toLocaleDateString()===e).length},remainingMessages(){return Math.max(0,this.dailyLimit-this.todayMessages)},isLimitReached(){return this.todayMessages>=this.dailyLimit}},methods:{submitMessage(){this.isLimitReached||!this.message.content.trim()||(this.message.date=new Date().toISOString(),this.$emit("message-submitted",{...this.message}),this.message.content="",this.$nextTick(()=>{this.$refs.contentInput.style.height="auto"}))},handleEnter(e){e.shiftKey||this.submitMessage()},adjustTextareaHeight(){const e=this.$refs.contentInput;e.style.height="auto",e.style.height=e.scrollHeight+"px"}},mounted(){this.$refs.contentInput.addEventListener("input",this.adjustTextareaHeight)},beforeUnmount(){this.$refs.contentInput.removeEventListener("input",this.adjustTextareaHeight)}},x={class:"message-form"},I={key:0,class:"limit-warning"},S={class:"input-group"},k={class:"message-info"};function E(e,s,d,c,i,a){return o(),r("div",x,[a.isLimitReached?(o(),r("div",I," 今日留言已达上限（20条），请明天再来留言 ")):(o(),r("form",{key:1,onSubmit:s[3]||(s[3]=u((...n)=>a.submitMessage&&a.submitMessage(...n),["prevent"])),class:"form-container"},[_(t("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=n=>i.message.name=n),required:"",placeholder:"昵称",class:"name-input"},null,512),[[p,i.message.name]]),t("div",S,[_(t("textarea",{"onUpdate:modelValue":s[1]||(s[1]=n=>i.message.content=n),required:"",rows:"1",placeholder:"输入留言内容...",class:"content-input",onKeydown:s[2]||(s[2]=v(u((...n)=>a.handleEnter&&a.handleEnter(...n),["prevent"]),["enter"])),ref:"contentInput"},null,544),[[p,i.message.content]]),s[4]||(s[4]=t("button",{type:"submit",class:"submit-btn",title:"发送"}," 发送 ",-1))]),t("div",k," 今日剩余留言次数："+g(a.remainingMessages),1)],32))])}const T=h(w,[["render",E],["__scopeId","data-v-b937ed87"]]);const D={name:"MessageList",props:{messages:{type:Array,default:()=>[]}},methods:{formatDate(e){return new Date(e).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},scrollToBottom(){this.$nextTick(()=>{const e=this.$refs.messagesContainer;e&&(e.scrollTop=e.scrollHeight)})}},watch:{messages:{handler(){this.scrollToBottom()},deep:!0}},mounted(){this.scrollToBottom()}},H={class:"message-list"},U={key:0,class:"no-messages"},j={key:1,class:"messages-container",ref:"messagesContainer"},F={class:"message-content"},O={class:"message-header"},$={class:"user-name"},C={class:"message-date"},N={class:"message-text"};function R(e,s,d,c,i,a){return o(),r("div",H,[d.messages.length===0?(o(),r("div",U," 还没有留言，来做第一个留言的人吧！ ")):(o(),r("div",j,[(o(!0),r(M,null,b(d.messages,(n,l)=>(o(),r("div",{key:l,class:"message-item"},[t("div",F,[t("div",O,[t("span",$,g(n.name),1),t("span",C,g(a.formatDate(n.date)),1)]),t("div",N,g(n.content),1)])]))),128))],512))])}const B=h(D,[["render",R],["__scopeId","data-v-be8be464"]]);const K={name:"Message",components:{MessageForm:T,MessageList:B},data(){return{messages:[],isInputHidden:!1,isLoading:!1}},methods:{async addMessage(e){try{await this.loadMessages(),this.messages.unshift(e),await this.saveMessages()}catch(s){console.error("Error adding message:",s),alert("发送消息失败，请稍后重试")}},async saveMessages(){try{const e=await fetch("https://api.github.com/repos/YOUR_USERNAME/YOUR_REPO/contents/public/data/messages.json",{method:"PUT",headers:{Authorization:"token YOUR_GITHUB_TOKEN","Content-Type":"application/json"},body:JSON.stringify({message:"Update messages",content:btoa(JSON.stringify(this.messages)),sha:this.currentSha})});if(!e.ok)throw new Error("Failed to save messages");const s=await e.json();this.currentSha=s.content.sha}catch(e){throw console.error("Error saving messages:",e),e}},async loadMessages(){if(!this.isLoading){this.isLoading=!0;try{const e=await fetch("/data/messages.json");if(!e.ok)throw new Error("Failed to load messages");const s=await e.json();this.messages=s}catch(e){console.error("Error loading messages:",e),alert("加载消息失败，请稍后重试")}finally{this.isLoading=!1}}},toggleInput(){this.isInputHidden=!this.isInputHidden}},created(){this.loadMessages()}},V={class:"message-page"},z={class:"message-container"},A={class:"controls"},J=["disabled"],Y=["title"];function q(e,s,d,c,i,a){const n=f("MessageList"),l=f("MessageForm");return o(),r("div",V,[t("div",z,[t("div",A,[t("button",{class:"refresh-btn",onClick:s[0]||(s[0]=(...m)=>a.loadMessages&&a.loadMessages(...m)),disabled:i.isLoading,title:"刷新留言"},g(i.isLoading?"加载中...":"刷新留言"),9,J)]),y(n,{messages:i.messages},null,8,["messages"]),t("div",{class:L(["input-area",{hidden:i.isInputHidden}])},[y(l,{onMessageSubmitted:a.addMessage},null,8,["onMessageSubmitted"])],2),t("button",{class:"toggle-input-btn",onClick:s[1]||(s[1]=(...m)=>a.toggleInput&&a.toggleInput(...m)),title:i.isInputHidden?"显示输入框":"隐藏输入框"},g(i.isInputHidden?"v":"^"),9,Y)])])}const G=h(K,[["render",q],["__scopeId","data-v-cb3b19e1"]]);export{G as default};
