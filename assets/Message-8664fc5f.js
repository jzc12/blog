import{_ as l,o,c as r,i as u,j as _,v as h,b as a,k as M,t as g,F as y,d as b,r as p,g as f,n as I}from"./index-1bc6f836.js";const x={name:"MessageForm",data(){return{message:{name:"",content:"",date:null},dailyLimit:20}},computed:{todayMessages(){const e=new Date().toLocaleDateString();return JSON.parse(localStorage.getItem("blog-messages")||"[]").filter(d=>new Date(d.date).toLocaleDateString()===e).length},remainingMessages(){return Math.max(0,this.dailyLimit-this.todayMessages)},isLimitReached(){return this.todayMessages>=this.dailyLimit}},methods:{submitMessage(){this.isLimitReached||!this.message.content.trim()||(this.message.date=new Date().toISOString(),this.$emit("message-submitted",{...this.message}),this.message.content="",this.$nextTick(()=>{this.$refs.contentInput.style.height="auto"}))},handleEnter(e){e.shiftKey||this.submitMessage()},adjustTextareaHeight(){const e=this.$refs.contentInput;e.style.height="auto",e.style.height=e.scrollHeight+"px"}},mounted(){this.$refs.contentInput.addEventListener("input",this.adjustTextareaHeight)},beforeUnmount(){this.$refs.contentInput.removeEventListener("input",this.adjustTextareaHeight)}},L={class:"message-form"},S={key:0,class:"limit-warning"},D={class:"input-group"},k={class:"message-info"};function w(e,s,d,m,i,n){return o(),r("div",L,[n.isLimitReached?(o(),r("div",S," 今日留言已达上限（20条），请明天再来留言 ")):(o(),r("form",{key:1,onSubmit:s[3]||(s[3]=u((...t)=>n.submitMessage&&n.submitMessage(...t),["prevent"])),class:"form-container"},[_(a("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=t=>i.message.name=t),required:"",placeholder:"昵称",class:"name-input"},null,512),[[h,i.message.name]]),a("div",D,[_(a("textarea",{"onUpdate:modelValue":s[1]||(s[1]=t=>i.message.content=t),required:"",rows:"1",placeholder:"输入留言内容...",class:"content-input",onKeydown:s[2]||(s[2]=M(u((...t)=>n.handleEnter&&n.handleEnter(...t),["prevent"]),["enter"])),ref:"contentInput"},null,544),[[h,i.message.content]]),s[4]||(s[4]=a("button",{type:"submit",class:"submit-btn",title:"发送"}," 发送 ",-1))]),a("div",k," 今日剩余留言次数："+g(n.remainingMessages),1)],32))])}const H=l(x,[["render",w],["__scopeId","data-v-b937ed87"]]);const $={name:"MessageList",props:{messages:{type:Array,default:()=>[]}},methods:{formatDate(e){return new Date(e).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},scrollToBottom(){this.$nextTick(()=>{const e=this.$refs.messagesContainer;e&&(e.scrollTop=e.scrollHeight)})}},watch:{messages:{handler(){this.scrollToBottom()},deep:!0}},mounted(){this.scrollToBottom()}},T={class:"message-list"},F={key:0,class:"no-messages"},B={key:1,class:"messages-container",ref:"messagesContainer"},C={class:"message-content"},E={class:"message-header"},N={class:"user-name"},j={class:"message-date"},O={class:"message-text"};function V(e,s,d,m,i,n){return o(),r("div",T,[d.messages.length===0?(o(),r("div",F," 还没有留言，来做第一个留言的人吧！ ")):(o(),r("div",B,[(o(!0),r(y,null,b(d.messages,(t,c)=>(o(),r("div",{key:c,class:"message-item"},[a("div",C,[a("div",E,[a("span",N,g(t.name),1),a("span",j,g(n.formatDate(t.date)),1)]),a("div",O,g(t.content),1)])]))),128))],512))])}const J=l($,[["render",V],["__scopeId","data-v-be8be464"]]);const K={name:"Message",components:{MessageForm:H,MessageList:J},data(){return{messages:[],isInputHidden:!1}},methods:{addMessage(e){this.messages.unshift(e),this.saveMessages()},saveMessages(){localStorage.setItem("blog-messages",JSON.stringify(this.messages))},loadMessages(){const e=localStorage.getItem("blog-messages");e&&(this.messages=JSON.parse(e))},toggleInput(){this.isInputHidden=!this.isInputHidden}},created(){this.loadMessages()}},R={class:"message-page"},U={class:"message-container"},q=["title"];function z(e,s,d,m,i,n){const t=p("MessageList"),c=p("MessageForm");return o(),r("div",R,[a("div",U,[f(t,{messages:i.messages},null,8,["messages"]),a("div",{class:I(["input-area",{hidden:i.isInputHidden}])},[f(c,{onMessageSubmitted:n.addMessage},null,8,["onMessageSubmitted"])],2),a("button",{class:"toggle-input-btn",onClick:s[0]||(s[0]=(...v)=>n.toggleInput&&n.toggleInput(...v)),title:i.isInputHidden?"显示输入框":"隐藏输入框"},g(i.isInputHidden?"↑":"↓"),9,q)])])}const G=l(K,[["render",z],["__scopeId","data-v-4afece5e"]]);export{G as default};
