import{av as E,b6 as O,bk as X,b7 as G,o as f,c as v,bl as R,az as M,aK as k,b8 as D,aQ as I,aO as L,aP as q,bm as Y,bn as x,aA as J,bg as ee,au as te,aI as se,aJ as ne,aB as H,bo as ae,bp as oe,ay as U,aD as re,aN as ie}from"./index-3cbe463d.js";const V=["快乐的","可爱的","聪明的","温柔的","活泼的","优雅的","善良的","开朗的","文静的","机智的","幽默的","热情的"],z=["小猫","小狗","小兔","小鸟","小熊","小鹿","小象","小狐狸","小松鼠","小浣熊","小海豚","小企鹅"],ce={name:"MessageForm",data(){return{showInputs:!0,message:{username:"",content:"",email:"",private_message:!1},dailyLimit:20,todayCount:0,isLoadingCount:!1}},computed:{remainingMessages(){return Math.max(0,this.dailyLimit-this.todayCount)},isLimitReached(){return this.remainingMessages<=0},iconMap(){return O}},methods:{generateRandomName(){const u=V[Math.floor(Math.random()*V.length)],i=z[Math.floor(Math.random()*z.length)];this.message.username=u+i},async fetchTodayCount(){this.isLoadingCount=!0,this.todayCount=await X(),this.isLoadingCount=!1},async submitMessage(){this.isLimitReached||!this.message.content.trim()||(this.$emit("message-submitted",{...this.message}),this.message.content="",this.message.private_message=!1,this.$nextTick(()=>{this.$refs.contentInput.style.height="auto"}),await this.fetchTodayCount())},handleEnter(u){u.shiftKey||this.submitMessage()},adjustTextareaHeight(){const u=this.$refs.contentInput;u.style.height="auto",u.style.height=u.scrollHeight+"px"}},mounted(){this.$refs.contentInput.addEventListener("input",this.adjustTextareaHeight),this.fetchTodayCount()},watch:{showInputs(u){this.$nextTick(()=>{const i=this.$refs.contentInput;u&&i?i.addEventListener("input",this.adjustTextareaHeight):i&&i.removeEventListener("input",this.adjustTextareaHeight)})}}},ue={class:"message-form"},le={key:0,class:"limit-warning"},de={class:"form-header"},ge={key:0,class:"input-group"},me={key:0,class:"private-toggle"},he={type:"submit",class:"submit-btn"};function fe(u,i,h,y,d,c){const m=G("tooltip");return f(),v("div",ue,[c.isLimitReached?(f(),v("div",le," 今日留言已达上限（20条），请明天再来留言 ")):(f(),v("form",{key:1,onSubmit:i[7]||(i[7]=R((...l)=>c.submitMessage&&c.submitMessage(...l),["prevent"])),class:"form-container"},[M("div",de,[M("button",{type:"button",class:"toggle-input-btn",onClick:i[0]||(i[0]=l=>d.showInputs=!d.showInputs)},[(f(),k(D(d.showInputs?c.iconMap.squareChevronDown:c.iconMap.squareChevronUp)))]),d.showInputs?(f(),v("button",{key:0,type:"button",class:"toggle-input-btn",onClick:i[1]||(i[1]=(...l)=>c.generateRandomName&&c.generateRandomName(...l)),title:"随机昵称"},[(f(),k(D(c.iconMap.shuffle)))])):I("",!0),d.showInputs?L((f(),v("input",{key:1,type:"text","onUpdate:modelValue":i[2]||(i[2]=l=>d.message.username=l),required:"",placeholder:"昵称",class:"name-input"},null,512)),[[q,d.message.username]]):I("",!0),d.showInputs?L((f(),v("input",{key:2,"onUpdate:modelValue":i[3]||(i[3]=l=>d.message.email=l),placeholder:"邮箱（可选）",type:"email",class:"email-input"},null,512)),[[q,d.message.email]]):I("",!0)]),d.showInputs?(f(),v("div",ge,[d.showInputs?(f(),v("label",me,[L(M("input",{type:"checkbox","onUpdate:modelValue":i[4]||(i[4]=l=>d.message.private_message=l)},null,512),[[Y,d.message.private_message]]),i[8]||(i[8]=M("span",{class:"toggle-label"},"私信",-1))])):I("",!0),L(M("textarea",{"onUpdate:modelValue":i[5]||(i[5]=l=>d.message.content=l),required:"",rows:"1",placeholder:"输入留言内容...",class:"content-input",onKeydown:i[6]||(i[6]=x(R((...l)=>c.handleEnter&&c.handleEnter(...l),["prevent"]),["enter"])),ref:"contentInput"},null,544),[[q,d.message.content]]),L((f(),v("button",he,i[9]||(i[9]=[J(" 发送 ")]))),[[m,"发送"]])])):I("",!0)],32))])}const pe=E(ce,[["render",fe],["__scopeId","data-v-0cdeaf1a"]]),_e="/blog/assets/avatar_0-59454510.png",ve="/blog/assets/avatar_1-ab07e3f0.png",Me="/blog/assets/avatar_2-269bf39f.png",be="/blog/assets/avatar_3-16b94276.png";var P={exports:{}};(function(u){(function(i){function h(e,r){var t=(e&65535)+(r&65535),g=(e>>16)+(r>>16)+(t>>16);return g<<16|t&65535}function y(e,r){return e<<r|e>>>32-r}function d(e,r,t,g,_,b){return h(y(h(h(r,e),h(g,b)),_),t)}function c(e,r,t,g,_,b,w){return d(r&t|~r&g,e,r,_,b,w)}function m(e,r,t,g,_,b,w){return d(r&g|t&~g,e,r,_,b,w)}function l(e,r,t,g,_,b,w){return d(r^t^g,e,r,_,b,w)}function p(e,r,t,g,_,b,w){return d(t^(r|~g),e,r,_,b,w)}function C(e,r){e[r>>5]|=128<<r%32,e[(r+64>>>9<<4)+14]=r;var t,g,_,b,w,s=1732584193,n=-271733879,a=-1732584194,o=271733878;for(t=0;t<e.length;t+=16)g=s,_=n,b=a,w=o,s=c(s,n,a,o,e[t],7,-680876936),o=c(o,s,n,a,e[t+1],12,-389564586),a=c(a,o,s,n,e[t+2],17,606105819),n=c(n,a,o,s,e[t+3],22,-1044525330),s=c(s,n,a,o,e[t+4],7,-176418897),o=c(o,s,n,a,e[t+5],12,1200080426),a=c(a,o,s,n,e[t+6],17,-1473231341),n=c(n,a,o,s,e[t+7],22,-45705983),s=c(s,n,a,o,e[t+8],7,1770035416),o=c(o,s,n,a,e[t+9],12,-1958414417),a=c(a,o,s,n,e[t+10],17,-42063),n=c(n,a,o,s,e[t+11],22,-1990404162),s=c(s,n,a,o,e[t+12],7,1804603682),o=c(o,s,n,a,e[t+13],12,-40341101),a=c(a,o,s,n,e[t+14],17,-1502002290),n=c(n,a,o,s,e[t+15],22,1236535329),s=m(s,n,a,o,e[t+1],5,-165796510),o=m(o,s,n,a,e[t+6],9,-1069501632),a=m(a,o,s,n,e[t+11],14,643717713),n=m(n,a,o,s,e[t],20,-373897302),s=m(s,n,a,o,e[t+5],5,-701558691),o=m(o,s,n,a,e[t+10],9,38016083),a=m(a,o,s,n,e[t+15],14,-660478335),n=m(n,a,o,s,e[t+4],20,-405537848),s=m(s,n,a,o,e[t+9],5,568446438),o=m(o,s,n,a,e[t+14],9,-1019803690),a=m(a,o,s,n,e[t+3],14,-187363961),n=m(n,a,o,s,e[t+8],20,1163531501),s=m(s,n,a,o,e[t+13],5,-1444681467),o=m(o,s,n,a,e[t+2],9,-51403784),a=m(a,o,s,n,e[t+7],14,1735328473),n=m(n,a,o,s,e[t+12],20,-1926607734),s=l(s,n,a,o,e[t+5],4,-378558),o=l(o,s,n,a,e[t+8],11,-2022574463),a=l(a,o,s,n,e[t+11],16,1839030562),n=l(n,a,o,s,e[t+14],23,-35309556),s=l(s,n,a,o,e[t+1],4,-1530992060),o=l(o,s,n,a,e[t+4],11,1272893353),a=l(a,o,s,n,e[t+7],16,-155497632),n=l(n,a,o,s,e[t+10],23,-1094730640),s=l(s,n,a,o,e[t+13],4,681279174),o=l(o,s,n,a,e[t],11,-358537222),a=l(a,o,s,n,e[t+3],16,-722521979),n=l(n,a,o,s,e[t+6],23,76029189),s=l(s,n,a,o,e[t+9],4,-640364487),o=l(o,s,n,a,e[t+12],11,-421815835),a=l(a,o,s,n,e[t+15],16,530742520),n=l(n,a,o,s,e[t+2],23,-995338651),s=p(s,n,a,o,e[t],6,-198630844),o=p(o,s,n,a,e[t+7],10,1126891415),a=p(a,o,s,n,e[t+14],15,-1416354905),n=p(n,a,o,s,e[t+5],21,-57434055),s=p(s,n,a,o,e[t+12],6,1700485571),o=p(o,s,n,a,e[t+3],10,-1894986606),a=p(a,o,s,n,e[t+10],15,-1051523),n=p(n,a,o,s,e[t+1],21,-2054922799),s=p(s,n,a,o,e[t+8],6,1873313359),o=p(o,s,n,a,e[t+15],10,-30611744),a=p(a,o,s,n,e[t+6],15,-1560198380),n=p(n,a,o,s,e[t+13],21,1309151649),s=p(s,n,a,o,e[t+4],6,-145523070),o=p(o,s,n,a,e[t+11],10,-1120210379),a=p(a,o,s,n,e[t+2],15,718787259),n=p(n,a,o,s,e[t+9],21,-343485551),s=h(s,g),n=h(n,_),a=h(a,b),o=h(o,w);return[s,n,a,o]}function F(e){var r,t="",g=e.length*32;for(r=0;r<g;r+=8)t+=String.fromCharCode(e[r>>5]>>>r%32&255);return t}function T(e){var r,t=[];for(t[(e.length>>2)-1]=void 0,r=0;r<t.length;r+=1)t[r]=0;var g=e.length*8;for(r=0;r<g;r+=8)t[r>>5]|=(e.charCodeAt(r/8)&255)<<r%32;return t}function Q(e){return F(C(T(e),e.length*8))}function Z(e,r){var t,g=T(e),_=[],b=[],w;for(_[15]=b[15]=void 0,g.length>16&&(g=C(g,e.length*8)),t=0;t<16;t+=1)_[t]=g[t]^909522486,b[t]=g[t]^1549556828;return w=C(_.concat(T(r)),512+r.length*8),F(C(b.concat(w),512+128))}function N(e){var r="0123456789abcdef",t="",g,_;for(_=0;_<e.length;_+=1)g=e.charCodeAt(_),t+=r.charAt(g>>>4&15)+r.charAt(g&15);return t}function A(e){return unescape(encodeURIComponent(e))}function S(e){return Q(A(e))}function $(e){return N(S(e))}function j(e,r){return Z(A(e),A(r))}function W(e,r){return N(j(e,r))}function B(e,r,t){return r?t?j(r,e):W(r,e):t?S(e):$(e)}u.exports?u.exports=B:i.md5=B})(ee)})(P);var ye=P.exports;const K=te(ye);const we={name:"MessageList",props:{messages:{type:Array,default:()=>[]}},methods:{formatDate(u){if(!u)return"";const i=new Date(u),h=new Date,y=h-i;return y<24*60*60*1e3&&i.getDate()===h.getDate()?i.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):y<7*24*60*60*1e3?["周日","周一","周二","周三","周四","周五","周六"][i.getDay()]+" "+i.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):i.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},scrollToBottom(){this.$nextTick(()=>{const u=this.$refs.messagesContainer;u&&(u.scrollTop=u.scrollHeight)})},getAvatar(u,i){if(u&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u)){const h=u.trim().toLowerCase(),y=h.match(/^(\d{5,11})@qq\.com$/);return y?`https://q1.qlogo.cn/g?b=qq&nk=${y[1]}&s=100`:h.match(/^([a-zA-Z0-9_.-]+)@(163|126|yeah)\.com$/)?`https://www.gravatar.com/avatar/${K(h)}?d=identicon`:`https://www.gravatar.com/avatar/${K(h)}?d=identicon`}else{const h=i?i.length%4:0;return new URL(Object.assign({"../assets/avatar_0.png":_e,"../assets/avatar_1.png":ve,"../assets/avatar_2.png":Me,"../assets/avatar_3.png":be})[`../assets/avatar_${h}.png`],self.location).href}},onAvatarError(u){u.target.src=require("../assets/avatar_0.png")}},watch:{messages:{handler(){this.scrollToBottom()},deep:!0}},mounted(){this.scrollToBottom()}},Ce={class:"message-list"},Le={key:0,class:"no-messages"},Ie={key:1,class:"messages-container",ref:"messagesContainer"},ke={class:"message-content"},De={class:"message-header"},Te=["src"],Ae={class:"user-name"},qe={class:"message-date"},He={class:"message-text"};function Ee(u,i,h,y,d,c){return f(),v("div",Ce,[h.messages.length===0?(f(),v("div",Le,i[1]||(i[1]=[M("i",{class:"far fa-comments"},null,-1),J(" 还没有留言，来做第一个留言的人吧！ ")]))):(f(),v("div",Ie,[(f(!0),v(se,null,ne(h.messages,(m,l)=>(f(),v("div",{key:l,class:"message-item"},[M("div",ke,[M("div",De,[M("img",{src:c.getAvatar(m.email,m.username),class:"avatar",onError:i[0]||(i[0]=p=>c.onAvatarError(p))},null,40,Te),M("span",Ae,H(m.username),1),M("span",qe,H(c.formatDate(m.created_at)),1)]),M("div",He,H(m.content),1)])]))),128))],512))])}const Fe=E(we,[["render",Ee],["__scopeId","data-v-96739a88"]]);const Ne={name:"Message",components:{MessageForm:pe,MessageList:Fe},data(){return{messages:[],isInputHidden:!1,isLoading:!1,isAscending:!0}},computed:{sortedMessages(){return[...this.messages].sort((u,i)=>{const h=new Date(u.created_at).getTime(),y=new Date(i.created_at).getTime();return this.isAscending?h-y:y-h})},iconMap(){return O}},methods:{toggleSort(){this.isAscending=!this.isAscending},async addMessage(u){try{await ae(u)?(await this.loadMessages(),this.$refs.messageForm&&await this.$refs.messageForm.fetchTodayCount()):alert("发送消息失败，请稍后重试")}catch{alert("发送消息失败，请稍后重试")}},async loadMessages(){if(!this.isLoading){this.isLoading=!0;try{const u=await oe();this.messages=u,this.$refs.messageForm&&await this.$refs.messageForm.fetchTodayCount()}catch{alert("加载消息失败，请稍后重试")}finally{this.isLoading=!1}}},toggleInput(){this.isInputHidden=!this.isInputHidden}},created(){this.loadMessages()}},Se={class:"message-container"},je={class:"controls"},Be={class:"control-group"},Re=["disabled"];function Ue(u,i,h,y,d,c){const m=U("MessageList"),l=U("MessageForm"),p=G("tooltip");return f(),v("div",Se,[M("div",je,[i[2]||(i[2]=M("div",{class:"text"},[M("p",null,"欢迎留言！私信不会显示，但是我会收到")],-1)),M("div",Be,[L((f(),v("button",{class:"control-btn",onClick:i[0]||(i[0]=(...C)=>c.toggleSort&&c.toggleSort(...C))},[(f(),k(D(d.isAscending?c.iconMap.sortDesc:c.iconMap.sortAsc),{class:"icon"}))])),[[p,d.isAscending?"切换为最新消息在前":"切换为最早消息在前"]]),L((f(),v("button",{class:"control-btn",onClick:i[1]||(i[1]=(...C)=>c.loadMessages&&c.loadMessages(...C)),disabled:d.isLoading},[(f(),k(D(d.isLoading?c.iconMap.loading:c.iconMap.refresh),{class:"icon"}))],8,Re)),[[p,"刷新留言"]])])]),re(m,{messages:c.sortedMessages},null,8,["messages"]),M("div",{class:ie(["input-area",{hidden:d.isInputHidden}])},[d.isInputHidden?I("",!0):(f(),k(l,{key:0,ref:"messageForm",onMessageSubmitted:c.addMessage},null,8,["onMessageSubmitted"]))],2)])}const ze=E(Ne,[["render",Ue],["__scopeId","data-v-9fac105c"]]);export{ze as default};
